<div class="container mt-5 pb-5">
  <div class="card shadow-sm border-0 mb-4">
    <div class="card-header bg-white py-3 border-bottom">
      <h3 class="m-0 text-primary fw-bold">
        <i class="bi bi-people-fill me-2"></i>Seleccione un Cliente
      </h3>
    </div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th class="ps-4">IDENTIFICACIÓN</th>
              <th>NOMBRE COMPLETO</th>
              <th class="text-center">ACCIÓN</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let cliente of clientes"
                (click)="seleccionarCliente(cliente)"
                [class.table-primary]="clienteSeleccionado?.idCliente === cliente.idCliente"
                style="cursor: pointer;">
              <td class="ps-4">{{ cliente.numeroIdentificacion }}</td>
              <td class="fw-bold">{{ cliente.nombre }} {{ cliente.apellidoPaterno }}</td>
              <td class="text-center">
                <button class="btn btn-sm btn-primary">
                  <i class="bi bi-search me-1"></i> Ver Pólizas
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div *ngIf="clienteSeleccionado" class="animate__animated animate__fadeIn">
    <div class="card shadow border-0 bg-light">
      <div class="card-header bg-primary text-white py-3 d-flex justify-content-between align-items-center">
        <h4 class="m-0">
          <i class="bi bi-shield-lock-fill me-2"></i>
          Pólizas de: {{ clienteSeleccionado.nombre }} {{ clienteSeleccionado.apellidoPaterno }}
        </h4>
        <button class="btn btn-light btn-sm fw-bold"
                [routerLink]="['/poliza/form', clienteSeleccionado.idCliente]">
          <i class="bi bi-plus-lg me-1"></i> Nueva Póliza
        </button>
      </div>

      <div class="card-body p-0 bg-white">
        <div *ngIf="loadingPolizas" class="text-center py-4">
          <div class="spinner-border text-primary" role="status"></div>
        </div>

        <div class="table-responsive" *ngIf="!loadingPolizas">
          <table class="table table-hover align-middle mb-0">
            <thead class="table-secondary">
              <tr>
                <th class="ps-4">TIPO</th>
                <th>MONTO</th>
                <th>VIGENCIA</th>
                <th>ESTADO</th>
                <th class="text-center">ACCIONES</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let poliza of polizas">
                <td class="ps-4">
                  <span class="fw-bold text-dark">{{ poliza.nombreTipoPoliza }}</span>
                </td>
                <td class="fw-bold text-success">{{ poliza.montoAsegurado | currency }}</td>
                <td>{{ poliza.fechaInicio | date:'shortDate' }} - {{ poliza.fechaFin | date:'shortDate' }}</td>
                <td>
                  <span class="badge rounded-pill"
                        [ngClass]="poliza.estado === 'Activa' ? 'bg-success' : 'bg-danger'">
                    {{ poliza.estado }}
                  </span>
                </td>
                <td class="text-center">
                  <button class="btn btn-outline-warning btn-sm me-2"
                          [routerLink]="['/poliza/form', clienteSeleccionado.idCliente, poliza.idPoliza]">
                    <i class="bi bi-pencil"></i>
                  </button>
                  <button class="btn btn-outline-danger btn-sm" (click)="eliminarPoliza(poliza.idPoliza)">
                    <i class="bi bi-trash"></i>
                  </button>
                </td>
              </tr>
              <tr *ngIf="polizas.length === 0">
                <td colspan="5" class="text-center py-4 text-muted">
                  Este cliente aún no tiene pólizas registradas.
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
